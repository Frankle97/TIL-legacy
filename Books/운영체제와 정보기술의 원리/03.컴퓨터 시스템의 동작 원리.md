# 컴퓨터 시스템의 동작 원리
## 컴퓨터 시스템의 구조
컴퓨터 시스템은 내부장치인 CPU, 메모리와 외부장치인 디스크, 키보드, 마우스 등으로 구성된다.
외부 장치에서 내부 장치로 데이터를 읽어와 각종 연산을 수행한 후 결과를 외부 장치로 다시 내보내는 방식이다.
이때 컴퓨터 내부로 데이터가 들어오는 것을 입력(Input)이라고 하고, 외부장치로 데이터가 나가는 것을 출력(output)이라고 한다.

운영체제는 부팅 때부터 항상 메모리에 올라가있지만, 운영체제의 모든 부분이 다 메모리에 상주하고 있다면 낭비가 발생하게 된다.
따라서 운영체제 중 항상 메모리에 올라가 있는 부분은 운영체제의 핵심적 부분에 한정되며, 이 부분을 **커널**이라고 한다.

## CPU 연산과 I/O 연산
각 장치의 컨트롤러마다 출입 데이터를 임시로 저장하기 위한 작은 메모리를 갖고 있는데, 이를 **로컬버퍼**라고 부른다.
외부장치에서 데이터를 읽어오는 경우, 우선 로컬버퍼에 데이터를 임시로 저장한 뒤에 메모리에 전달한다.

로컬버퍼로 읽어오는 작업이 끝났는지는 CPU가 지속적으로 체크하는 것이 아니라 장치의 컨트롤러가 인터럽트를 발생시켜 CPU에 알린다.
기본적으로 CPU는 매 시점 메모리에서 명령을 하나씩 읽어서 수행하는데, 옆에 인터럽트 라인이 있어 작업 중간에 인터럽트 라인에 신호가 들어오면 인터럽트 관련된 일을 우선하여 처리한다.

즉, CPU는 명령 하나를 수행할 때마다 인터럽트를 확인하고 발생했다면 다음 명령 수행 이전에 인터럽트를 먼저 처리하는 것이다.

## 인터럽트의 일반적 기능
운영체제는 각종 하드웨어 및 소프트웨어 자원 관리뿐 아니라 사용자 프로그램에게 필요한 서비스도 미리 프로그래밍하여 커널 내에 포함시킨다.

## 인터럽트 핸들링
**인터럽트 핸들링**이란 인터럽트가 발생한 경우 처리해야 할 일의 절차를 의미한다.
프로그램이 실행되는 도중에 인터럽트가 발생하면 해당 프로그램의 상태(메모리 주소 등 부가적인 정보)를 먼저 저장한다.
CPU에서 명령이 실행될 때에는 CPU 내부의 임시 기억장치인 레지스터에서 데이터를 읽거나 쓰면서 작업을 하는데, 이때 인터럽트가 발생해 새로운 명령을 실행하게 된다면 기존 레지스터 값들이 모두 지워지게
되므로 CPU 내에 상태를 저장해두어야 인터럽트 처리가 이루어질 수 있다.

운영체제는 현재 시스템 내 실행 중인 프로그램들을 관리하기 위해 **프로세스 제어블록(PCB, Process Control Block)** 라는 자료구조를 둔다.
PCB는 각 프로그램 마다 존재하며 해당 프로그램의 어느 부분이 실행 중이었는지, 코드의 메모리 주소와 레지스터 값, 하드웨어 상태 등을 저장한다.
예로 어떤 프로그램이 실행 도중에 인터럽트가 발생하면 해당 프로그램 실행 상태를 PCB에 저장한 후 CPU의 제어권은 인터럽트 처리루틴으로 넘어가게 되며,
인터럽트 처리가 끝나면 저장된 상태를 PCB로부터 읽어 CPU상으로 복원해 인터럽트 당하기 직전 위치부터 실행이 이어지게 된다.

## 입출력 구조
입출력 방식에는 동기식 입출력과 비동기식 입출력이 있다.
동기식 입출력에서 CPU는 입출력 연산이 끝날 때까지 인터럽트를 기다리며 자원을 낭비하게 된다.
