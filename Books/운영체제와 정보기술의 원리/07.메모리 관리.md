# 메모리 관리
- 컴퓨터는 byte 단위로 메모리 주소를 부여한다.

## 주소 바인딩
- 프로그램이 실행되면 메모리에 프로세스를 위한 독자적인 주소 공간이 생성됨
- CPU는 프로세스의 독립적인 **논리적 주소**에 근거하여 명령을 실행
- 논리적 주소
  - 각 프로세스마다 독립적으로 할당되며 0번지부터 시작됨
- 물리적 주소
  - 물리적 메모리에 실제로 올라가는 위치
  - 보통 낮은 주소 영역에는 운영체제, 높은 주소 영역에는 사용자 프로세스들이 올라감
- 주소 바인딩
  - 프로세스의 논리적 주소를 물리적 메모리 주소로 연결시켜주는 작업을 의미
  
### 주소 바인딩 방식
프로그램이 적재되는 물리적 메모리 주소가 결정되는 시기에 따라 분류된다.

- **컴파일 타임 바인딩**
  - 컴파일 시점에 프로그램이 물리적 메모리의 어디에 위치할 것인지를 결정되는 방식
  - 프로그램이 올라간 상태에서 물리적 메모리 위치를 변경하려면 컴파일을 다시 해야 한다.
  - 비현실적이고 시분할 컴퓨팅 환경에서 잘 사용하지 않는 기법이다.
- **로드 타임 바인딩**
  - 프로그램 실행이 시작될 때 물리적 메모리 주소가 결정되는 방식
  - 로더(*사용자 프로그램을 메모리에 적재하는 프로그램*) 의 책임하에 물리적 메모리 주소가 부여되며 프로그램 종료 전까지 물리적 메모리상의 위치가 고정됨
- **실행 시간 바인딩**
  - 프로그램 실행 중에 프로그램이 위치한 물리적 메모리 주소가 변경될 수 있는 방식


- **MMU(Memory Management Unit) 기법**
  - MMU는 **논리적 주소를 물리적 주소로 매핑**해주는 하드웨어 장치이다.
  - CPU가 특정 프로세스의 논리적 주소를 참조하려고 할 때 주소값에 기준 레지스터의 값을 더해 물리적 주소 값을 얻어낸다.
    - 여기서 기준 레지스터는 재배치 레지스터라고도 불리며 **프로세스의 물리적 메모리 시작 주소를 가지고 있다.**
  - 프로그램이 적재되는 물리적 메모리 시작 주소만 알면 주소 변환을 쉽게 할 수 있다.
  - 사용자 프로그램이나 CPU는 논리적 주소만을 다룰뿐 실제 물리적 주소는 몰라도 된다.
  - 다중 프로그래밍 환경에서는 메모리 영역에 대한 침범이 일어날 수 있고, 심각한 문제를 초래할 수 있어서 이를 방지하기 위해 **한계 레지스터**라는 또 다른 레지스터를 사용한다.

## 메모리 관리와 관련된 용어
### 동적로딩
- 다중 프로그래밍 환경에서 메모리 사용 효율을 높이기 위해 사용하는 기법
- 프로세스 주소 공간에 메모리 전체를 올리는 것이 아닌 불리는 부분만을 메모리에 적재하는 방식
  - => 프로세스 내에서 실행에 필요한 부분이 실제로 불리면 메모리에 적재함.
- **불필요한 코드들이 메모리를 차지하는 것을 방지**하여 메모리 효율성을 높임.

### 동적연결
- 컴파일로 생성된 목적 파일과 라이브러리 파일 사이의 연결을 프로그램 실행 시점까지 지연시키는 기법.
- 다수 프로그램이 공통 사용하는 라이브러리를 메모리에 한 번만 적재함으로써 메모리 효율성을 높일 수 있음.

### 중첩
- 프로세스의 주소 공간을 분할해 실제 필요한 부분만 메모리에 적재하는 기법.
- 동적로딩과의 차이
  - 동적로딩:  메모리에 더 많은 프로세스를 동시에 올려놓고 실행하기 위한 용도
  - 중첩: 단일 프로세스만 메모리에 올려놓는 환경에서 메모리 용량보다 큰 프로세스를 실행하기 위한 어쩔 수 없는 선택

### 스와핑
- **메모리에 존재하는 프로세스 수를 조절하는 역할**
- 메모리에 올라온 프로세스의 주소 공간 전체를 디스크의 스왑 영역에 일시적으로 내려놓는 것.
  - 스왑 영역은 프로세스가 수행 중인 동안에만 디스크에 일시적으로 저장하는 공간.
- **스왑 인**: 디스크에서 메모리로 올리는 작업
- **스왑 아웃**: 메모리에서 디스크로 내리는 작업

```
[예시]
1. LOL 프로그램을 실행하려고 하는데, 메모리가 충분하지 않은 상황이다.
2. 운영체제는 메모리에 존재하는 Word에 할당된 메모리 공간을 통째로 빼앗아 디스크의 스왑 영역으로 스왑 아웃 시킨다.
3. 이제 메모리에 여유 공간이 생겼으니 LOL 프로그램의 주소 공간을 스왑 인 시켜준다.
```

### 물리적 메모리의 할당 방식
- 물리적 메모리는 **운영체제 상주 영역**과 **사용자 프로세스 영역**으로 나뉜다.
- **운영체제 상주 영역**
  - 인터럽트 벡터와 함께 물리적 메모리의 낮은 주소 영역을 사용하며, 운영체제 커널이 위치하게 된다.
- **사용자 프로세스 영역**
  - 물리적 메모리의 높은 주소 영역을 사용하며, 여러 사용자 프로세스들이 적재된다.
  - 프로세스를 메모리에 올리는 방식에 따라 **연속할당 방식**과 **불연속할당 방식**으로 나뉜다.
#### 연속할당 방식
- 프로세스를 메모리에 올릴 때 주소 공간을 분할하지 않고 물리적 메모리 한 곳에 연속적으로 적재하는 방식이다.
- 물리적 메모리를 고정된 크기의 분할로 미리 나누어 놓는지에 따라 **고정분할**과 **가변분할** 방식으로 나뉜다.  
  - **고정분할 방식**
    - 물리적 메모리를 주어진 개수만큼의 영구적 분할로 미리 나누어두고 각 분할에 하나의 프로세스를 적재해 실행 가능하도록 하는 방식.
    - 분할 크기는 모두 동일할 수 있고, 서로 다르게 할 수도 있다.
    - 동시에 메모리에 올릴 수 있는 프로그램 수가 고정되고, 프로그램의 최대 크기도 제한된다는 점에서 융통성이 떨어진다.
    - **외부조각:** 프로그램 크기보다 분할 크기가 작아서 프로그램을 적재하지 못하기 때문에 발생하는 메모리 공간
    - **내부조각:** 프로그램의 크기보다 분할의 크기가 큰 경우 해당 분할에 프로그램을 적재하고 남는 메모리 공간
      - 수용할 수 있는 작은 크기의 프로그램이 있다 해도 공간을 활용할 수 없어 메모리가 낭비 된다.
  - **가변분할 방식**
    - 메모리에 적재되는 프로그램의 크기에 따라 분할의 크기, 개수가 동적으로 변하는 방식
    - 분할의 크기를 프로그램 크기보다 크게 할당하지는 않기에 내부조각은 발생하지 않음
    - 메모리에 있는 프로그램이 종료되면서 중간에 빈 공간이 발생하게 되고, 이 공간이 새 프로그램 크기보다 작다면 외부조각이 발생할 수 있음
#### 불연속할당 기법
- 하나의 프로세스가 물리적 메모리의 여러 위치에 분산되어 올라갈 수 있는 메모리 할당 기법
- 페이징 기법, 세그먼테이션 기법, 페이지드 세그먼테이션 기법 등이 있음

### 페이징 기법
- 프로세스 주소 공간을 동일한 크기의 페이지 단위로 나누어 물리적 메모리의 서로 다른 위치에 페이지들을 저장하는 방식
- 프로세스 주소 공간 전체를 물리적 메모리에 올리지 않고 일부는 백킹스토어, 일부는 물리적 메모리에 혼재시키는 것이 가능
- 연속할당에서 발생했던 동적 메모리 할당 문제에 안전함
- 모든 프로세스가 각자 주소 변환을 위해 페이지 테이블을 가지며, 이 테이블은 프로세스가 가질 수 있는 페이지 개수만큼 주소 변환 엔트리를 갖고 있다.
