# 2.6 불변 객체로 만드세요

## 가변 객체와 불변 객체에 대한 이해
- 클래스를 상태 변경이 불가능한 **불변 클래스**로 구현하면 유지보수성을 크게 향상시킬 수 있으며, 가변 클래스보다 더 직관적이게 된다.
- 인스턴스를 생성한 후에 상태 변경이 불가능한 객체를 불변 객체라고 말한다.
```java
// 가변 객체
class Cash {
    private int dollars;

    public void setDollars(int val) {
        this.dollars = val;
    }
}
```
- 가변 객체는 인스턴스를 생성한 뒤에 `setter` 등을 이용하여 내부 상태를 변경할 수 있다.
```java
// 불변 객체
class Cash {
    private final int dollars;

    Cash(int val) {
        this.dollars = val;
    }
}
```
- 불변 객체는 생성자에서 상태 값을 초기화하고, 인스턴스를 생성하고 난 이후에는 내부 상태 값을 변경할 수 없다.
- 불변 객체는 자신의 상태를 모두 캡슐화하고, 외부에서 직접 접근이 불가하도록 만든다.

## 불변 객체를 사용해야 하는 이유
- 가변 객체는 절자 치향의 산물이며, 예외 없이 어떠한 경우에도 가변 객체를 만들어서는 안된다.  
- 불변 객체는 어떤 방법으로도 자기 자신을 수정할 수 없으며, 항상 원하는 상태를 가지는 새로운 객체를 생성해서 반환한다.

### 식별자 가변성
- 자료구조 식별자로 가변 객체를 사용한다면, 식별자 객체의 내부 상태 변경이 변경될 수 있어, 자료구조의 식별자가 이전과 달리 변경되거나 중복될 수 있는 문제를 초래할 수 있다.  

### 실패 원자성
불변 객체는 원자적이므로 원자성에 대해 걱정할 필요가 없다. 가변 객체도 원자성을 보장할 수 있지만, 불변 객체에 비해 상대적으로 비용이 매우 크다.

### 시간적 결합
가변 객체는 객체 생성 이후에 `setter`로 상태를 초기화한다면 연산 순서에 따라 결과가 변할 수 있지만, 불변 객체는 인스턴스화와 초기화를 함께하는 완전한 상태로 초기화하기 때문에 시간적 결합에 대해 신경쓰지 않아도 된다.

### 부수효과 제거
가변 객체는 누구나 쉽게 수정할 수 있어 신뢰할 수 없고, 사이드 이펙트의 여지를 낳는다.

### NULL 참조 없애기
불변 객체는 생성과 초기화를 함께 하면서 완성된 객체를 만든다. 이는 가변 객체에 비해 NULL 참조에 훨씬 안정적인 모습이다.

### 스레드 안정성 
- 불변 객체는 상태를 수정할 수 없기 때문에 아무리 많은 스레드가 객체에 접근해도 해당 객체에 대한 신뢰가 보장된다.
- 가변 객체도 스레드 안정성을 지킬 수 있지만, 불변 객체에 비해 스레드 세이프를 위한 비용이 매우 크다.

### 더 작고 단순한 객체
불변 객체는 생성자 안에서만 상태를 초기화할 수 있어 코드 라인을 더 줄일 수 있다. 

# 의견
가변 객체는 객체를 신뢰할 수 없고, 누구나 객체에 대한 상태 접근이 가능하기 때문에 어떤 이의 객체 내부 상태 변경 하나로도 에러를 초래할 수 있고 이를 추적하기도 쉽지 않다. 
가변 객체에 비해 불변 객체가 훨씬 안정적이고, 장점이 훨씬 많다고 생각한다.   

불변 객체가 아닌 가변 객체가 꼭 필요한 상황이 있을까? 마땅히 떠오르지 않는다..

객체 지향 프로그래밍 관점에서 봤을 때, 객체는 서로 협력하는 관계인데, 가변 객체는 신뢰를 얻을 수 없다.
따라서 객체 지향 세계에서 가변 객체는 매우 지양해야 할 대상이 아닌가 생각이 든다.