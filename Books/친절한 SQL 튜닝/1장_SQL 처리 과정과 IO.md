# 1.1 SQL 파싱과 최적화

## 1.1 구조적, 집합적, 선언적 질의 언어

- SQL은 구조적이고 집합적이고 선언적인 질의 언어이다.
- 원하는 결과집합을 구조적, 집합적으로 선언하지만 그 결과집합을 만드는 과정은 절차적이다.
    - 즉, 프로시저가 필요한데, 그런 프로시저를 만들어 내는 DBMS 내부 엔진이 바로 SQL 옵티마이저이다.

## 1.2 SQL 파싱과 최적화

- DBMS 내부에서 프로시저를 작성하고 컴파일해서 실행 가능한 상태로 만드는 전 과정을 **SQL 최적화**라고 한다.
- SQL을 실행하기 전 최적화 과정을 세분화하면 아래와 같다.
    1. SQL 파싱
        - 사용자로부터 SQL을 전달받으면 가장 먼저 SQL 파서가 파싱을 잔행한다.
            - SQL 문법적 오류, 유효하지 않은 키워드, 존재하지 않는 테이블 또는 컬럼, 권한 등에 대한 검사
    2. SQL 최적화
        - 옵티마이저가 미리 수집한 시스템 및 오브젝트 통계정보를 바탕으로 다양한 실행경로를 생성해서 비교한 후 가장 효율적인 하나를 선택한다.
        - 옵티마이저는 데이터베이스 성능을 결정하는 가장 핵심적인 엔진이다.
    3. 로우 소스 생성
        - 옵티마이저가 선택한 실행경로를  로우 소스 생성기가 실제 실행 가능한 코드 또는 프로시저 형태로 포맷팅하는 단계이다.

## 1.3 SQL 옵티마이저

- SQL 옵티마이저는 SQL 작업을 가장 효율적으로 수행할 수 있도록 최적의 데이터 접근 경로를 선택해 주는 DBMS의 핵심 엔진이다.
- 옵티마이저의 최적화 단계를 요약하면 아래와 같다.
    1. 전달받은 쿼리를 수행하는 데 후보군이 될만한 실행계획들을 찾아낸다.
    2. 데이터 딕셔너리에 미리 수집해 둔 오브젝트 통계 및 시스템 통계정보를 이용해 각 실행계획의 예상비용을 산정한다.
    3. 최저 비용의 실행계획을 선택한다.

## 1.4 실행계획과 비용

- SQL 옵티마이저는 시스템에서 게산한 경로를 보여준다는 부분에서 네비게이션과 흡사하게 볼 수 있다.
- 네비게이션과 같이 경로를 미리 확인할 수 있으며, 만약 경로가 마음에 들지 않는다면 직접 변경할 수도 있다.
- 이와 같이 DBMS에서 SQL 실행 경로를 미리보는 기능을 **실행계획**이라고 한다.
- 실행계획의 Cost(비용)는 여러 통계정보를 활용해 쿼리를 수행하는 동안 발생할 것으로 예상하는 I/O 횟수 또는 예상 소요시간을 가리키는 정보이다.
- 실행계획의 Cost는 예상치에 불과하며, 실제와 차이가 있다.

## 1.5 옵티마이저 힌트

- 옵티마이저가 제시하는 경로가 대부분 최적의 선택이지만, 100%는 아니다.
- 개발자가 직접 더 효율적인 액세스 경로를 찾아낼 수도, 때도 있다.
- 이럴 때 옵티마이저 힌트를 이용해 데이터 액세스 경로를 바꿀 수 있다.