# 카프카의 내부 동작 원리와 구현
## 카프카 리플리케이션
카프카는 초기 설계부터 하드웨어 이슈 등으로 브로커에서 장애가 발생해도 데이터 허브로써 안정적인 서비스가 운영될 수 있도록 설계됐다.  
안정성을 확보하기 위해 카프카 내부에서는 리플리케이션이란 동작을 한다.

### 리플리케이션 동작 개요
카프카 리플리케이션 동작을 위해 토픽 생성 시 필수값으로 `replication factor` 옵션을 설정해주어야 한다.

### 리더와 팔로워
카프카는 내부적으로 모두 동일한 리플리케이션들을 리더와 팔로워로 구분하고, 각자 역할을 분담시킨다.  
리더는 리플리케이션 중 하나가 선정되며, 모든 읽기 쓰기는 리더를 통해서만 가능하다.  
즉, 프로듀서는 모든 리플리케이션에 메시지를 보내는 것이 아닌 리더에게만 메시지를 전송한다.  
컨슈머 또한 리더로부터만 메시지를 가져온다.

리더는 메시지를 읽고 쓰는 동작을 하고, 팔로워들은 리더에 문제가 발생할 경우 언제든 새로운 리더가 될 준비를 해야 한다.  
따라서 팔로워는 리더가 새로운 메시지를 받았는지 확인하고, 메시지가 있다면 리더로부터 복제한다.

### 복제 유지와 커밋
