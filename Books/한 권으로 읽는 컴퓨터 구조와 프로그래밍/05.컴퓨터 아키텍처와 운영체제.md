# 컴퓨터 아키텍처와 운영체제

`컴퓨터 아키텍처`라는 말은 컴퓨터의 여러 구성요소를 배치하는 방법을 의미한다.

`멀티태스킹`은 여러 프로그램을 동시에 실행하는 것처럼 보이게 하거나, 실제로 여러 프로그램을 동시에 실행하는 것을 뜻한다.
여러 프로그램을 실행한다는 말은 감독 프로그램인 `운영체제`가 있어야 한다.

## 기본적인 구조 요소들
컴퓨터 구조 중 가장 흔한 두 가지는 `폰 노이만` 구조와 `하버드` 구조이며 둘의 차이는 메모리 배열뿐이다.

메모리 배열을 제외하고 모두 같다면 메모리에서 동시에 명령어와 데이터를 가져올 수 없기에(데이터 버스와 주소 버스가 오직 하나) 폰 노이만 구조가 약간 더 **느리다**.<br/>
하버드 구조는 명령어와 데이터를 동시에 가져올 수 있어 좀 더 빠르지만 두 번째 메모리 처리를 위한 버스가 필요하다.

### 프로세스 코어
예전에 CPU라고 부르던 것은 요즘은 **프로세스 코어**라고 부르며, 이런 코어가 여럿 들어가는 **멀티코어** 프로세스가 이젠 일반적으로 사용된다.
실제로 데이터 센터 등에서 멀티코어 프로세스가 많이 들어간 시스템도 존재한다.

### 마이크로프로세서와 마이크로컴퓨터
메모리 I/O가 프로세서 코어와 같은 패키지에 있지 않으면 **마이크로프로세서**라고 부르며, 반대로 모든 요소가 한 칩 안에 패키징된다면 **마이크로컴퓨터**라고 부른다.

칩 안에서 메모리가 차지하는 영역이 크기 때문에 일반적으로 마이크로프로세서가 더 강력하다.

마이크로프로세서는 보통 큰 시스템에 들어가는 부품으로 쓰이고, 마이크로컴퓨터는 식기세척기 등에서 찾을 수 있는(단일 칩으로 된) 작은 컴퓨터이다.

## 프로시저, 서브루틴, 함수
엔지니어들은 귀찮은 일을 자신을 대신하여 무언가를 만드는 습성을 가진 경우가 있다.
프로그래머들은 중복된 코드를 기피한다.

`함수(또는 프로시저, 서브루틴)` 코드를 재사용하는 주요 수단이다.
위 용어들은 모두 동일한 것을 의미하여, 프로그래밍 언어에 따라 부르는 이름만 다르다.
우리는 `함수`라는 이름을 사용할 것이다.

> 우리는 이미 함수의 편의성을 충분히 알고 있기에 예제는 생략한다.

함수를 실행하고 다시 원래의 자리로 돌아오기 위해선 어디서 함수로 들어갔는지를 기억해야 한다. 이 위치는 바로 프로그램 카운터의 값이다.

## 스택
스택의 예로 함수 호출에서 돌아올 때는 접시 더미 맨 위의 접시를 보고 반환 주소를 결정한 다음, 접시를 제거한다.
이러한 구조를 물건을 쌓아 올린다는 뜻의 **스택**이라고 하며, LIFO(LastInFirstOut, 선입선출) 구조라고도 부른다.

스택은 **푸쉬**해서 넣고 **팝**해서 제거한다.
스택에 더 이상 푸쉬할 공간이 없다면 이를 **스택 오버플로**라고 하고, 스택이 비어 있는데 무언가를 가져오려고 한다면 **스택 언더플로***라고 한다.

## 인터럽트
프로세서 대부분은 **인터럽트** 시스템이 들어간다. 인터럽트 시스템은 적절한 신호가 들어오면 CPU 실행을 잠시 중단시킬 수 있는 핀이나 전기 연결을 포함한다.

인터럽스에서 고려해야할 부분이 몇 가지 있다.

- 응답시간
   - 응답 시간을 너무 많이 소요하면 안된다. >= 지연
- 상태 저장
  - 인터럽트를 마치고 본래 자리로 돌아오기 위해선 현재 상태를 저장할 방법이 필요하다.

인터럽트 시스템은 서비스 후 돌아올 위치를 스택에 저장한다.

## 상대 주소 지정
여러 프로그램을 동시에 실행하기 위해선 일종의 관리자 프로그램인 `운영체제(OS)` 또는 `운영체제 커널`이 필요하다.
또한 우리는 OS와 OS가 관리하는 프로그램을 구분하기 위해 OS를 시스템 프로그램, 이 외 프로그램들을 **사용자 프로그램** 또는 **프로세스**라고 부른다.

상대 주소 지정은 명령어의 주소를 기준으로 하는 상대적인 주소로 해석한다.
상대 주소 지정을 사용하면 프로그램을 메모리의 원하는 위치로 자유롭게 재배치할 수 있다.

## 메모리 관리 장치
오늘날 대부분의 마이크로프로세서에는 `메모리 관리 장치(MMU, memory management unit)`가 들어있다. MMU는 아주 복잡한 하드웨어이다.

MMU가 있는 시스템은 `가장 주소`와`물리 주소`를 구분한다. 프로그램은 가상 주소를 사용해 작성되고, MMU는 가상 주소를 물리 주소로 변환해준다.

## 가상 메모리
메모리 역시 OS가 관리하는 자원이다. OS는 MMU를 사용해 사용자 프로그램에게 `가상 메모리`를 제공한다.

## 메모리 계층과 성능
CPU > 레지스터 > L1 캐시 > L2 캐시 > L3 캐시 > 주 메모리 > 대량 저장장치

왼쪽에 가까울수록 빠르고 비싸다.

`캐시 미스`란 CPU가 캐시에서 어떤 내용을 캐시에 찾으려는데 캐시에 없어서 메모리를 읽어야하는 경우를 뜻한다.<br/>
반대로 `캐시 히트`는 원하는 내용을 캐시에서 찾은 경우를 뜻한다.
